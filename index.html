<!DOCTYPE html>

<html lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>SFW متجر إلكتروني</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&amp;display=swap" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<style>
    :root {
      --primary-color: #008080;  /* Teal */
      --secondary-color: #ffd700;  /* Gold */
      --accent-color: #f39c12;  /* Bright Amber */
      --text-color: #1e1e2f;
      --light-bg: #fdfcfb;
      --card-bg: #ffffff;
      --gradient-bg: linear-gradient(135deg, #008080 0%, #ffd700 100%);
      --border-radius: 16px;
      --box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
      --transition: all 0.3s ease-in-out;

      --primary-color: #6a11cb;
      --secondary-color: #2575fc;
      --accent-color: #ff6f61;
      --text-color: #1e1e2f;
      --light-bg: #f4f7f8;
      --card-bg: #ffffff;
      --gradient-bg: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
      --border-radius: 16px;
      --box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      --transition: all 0.3s ease-in-out;

      --primary-color: #ff4d6d;
      --secondary-color: #c9184a;
      --text-color: #333;
      --light-bg: #fdfbfb;
      --card-bg: #ffffff;
      --border-radius: 12px;
      --box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Cairo', sans-serif;
      direction: rtl;
      margin: 0;
      padding: 0;
      background: var(--light-bg);
      color: var(--text-color);
      min-height: 100vh;
      line-height: 1.6;
    }
    
    header {
      background-color: rgba(255, 255, 255, 0.95);
      padding: 12px 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      position: sticky;
      top: 0;
      z-index: 999;
      width: 100%;
      gap: 10px;
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
      min-width: 200px;
    }
    
    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .welcome {
      font-size: 1.1rem;
      font-weight: bold;
      color: #d63384;
      text-align: center;
      animation: glow 2s ease-in-out infinite alternate;
      flex: 1;
    }
    
    @keyframes glow {
      from { text-shadow: 0 0 5px #ffc6e0; }
      to { text-shadow: 0 0 15px #ff99c8; }
    }
    
    .login-form {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      z-index: 1000;
      width: 90%;
      max-width: 400px;
    }
    
    .login-form.active {
      display: block;
    }
    
    .login-form input {
      width: 100%;
      padding: 10px 12px;
      border-radius: var(--border-radius);
      border: 1px solid #ddd;
      font-family: 'Cairo';
      font-size: 0.95rem;
      margin: 8px 0;
    }
    
    .login-form button {
      transition: var(--transition);

      width: 100%;
      padding: 10px;
      font-size: 0.95rem;
    }
    
    .login-icon {
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--primary-color);
      transition: transform 0.3s;
    }
    
    .login-icon:hover {
      transform: scale(1.1);
    }
    
    h1, h2, h3 {
      color: var(--primary-color);
      margin: 1rem 0;
    }
    
    h1 {
      font-size: 1.8rem;
      text-align: center;
      padding: 0 16px;
    }
    
    h2 {
      font-size: 1.5rem;
      text-align: center;
    }
    
    h3 {
      font-size: 1.2rem;
    }
    
    #products, .admin-products {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      padding: 16px;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .card {
      animation: fadeInUp 0.6s ease-in-out;

      border: 1px solid #eee;
      padding: 16px;
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      transition: transform 0.3s, box-shadow 0.3s;
      display: flex;
      flex-direction: column;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    
    .card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: var(--border-radius);
      margin-bottom: 12px;
    }
    
    .order-form, .edit-form, .about-section, .contact-section {
      display: none;
      margin-top: 12px;
      background: #f9f9f9;
      padding: 12px;
      border-radius: var(--border-radius);
    }
    
    .order-form {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 500px;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    
    .order-form-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 999;
    }
    
    .order-form-overlay.active {
      display: block;
    }
    
    input, textarea, button {
      transition: var(--transition);

      width: 100%;
      padding: 10px 12px;
      border-radius: var(--border-radius);
      border: 1px solid #ddd;
      font-family: 'Cairo';
      font-size: 0.95rem;
      margin: 6px 0;
    }
    
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    button {
      transition: var(--transition);

      background-color: var(--primary-color);
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s, transform 0.2s;
      margin: 8px 0;
    }
    
    button:hover {
      transform: scale(1.05);
      background: var(--secondary-color); color: var(--text-color);

      background-color: var(--secondary-color);
      transform: scale(1.02);
    }
    
    button:active {
      transform: scale(0.98);
    }
    
    /* التعديلات الخاصة بالتفاصيل */
    .product-details {
      max-height: 80px;
      overflow: hidden;
      position: relative;
      margin: 8px 0;
    }
    
    .product-details.expanded {
      max-height: none;
      overflow: visible;
    }
    
    .show-more {
      color: var(--primary-color);
      cursor: pointer;
      text-align: left;
      margin: 5px 0;
      font-weight: bold;
      font-size: 0.9rem;
    }
    
    /* لوحة التحكم */
    .admin-section {
      display: none;
      padding: 16px;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .admin-tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid #ddd;
      overflow-x: auto;
      white-space: nowrap;
      -webkit-overflow-scrolling: touch;
    }
    
    .admin-tab {
      padding: 10px 20px;
      cursor: pointer;
      background: #f5f5f5;
      margin-left: 5px;
      border-radius: 8px 8px 0 0;
      font-size: 0.95rem;
    }
    
    .admin-tab.active {
      background: var(--primary-color);
      color: white;
    }
    
    .admin-tab-content {
      display: none;
      padding: 10px 0;
    }
    
    .admin-tab-content.active {
      display: block;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
      font-size: 0.9rem;
    }
    
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    
    th {
      background-color: #f5f5f5;
    }
    
    .main-store {
      display: block;
    }
    
    .admin-logged-in .main-store {
      display: none;
    }
    
    .top-buttons {
      display: flex;
      gap: 10px;
    }
    
    .top-buttons button {
      transition: var(--transition);

      width: auto;
      padding: 8px 16px;
      font-size: 0.9rem;
    }
    
    /* شريط البحث */
    .search-container {
      display: flex;
      margin: 16px auto;
      max-width: 600px;
      padding: 0 16px;
    }
    
    .search-container input {
      border-radius: var(--border-radius) 0 0 var(--border-radius);
      margin: 0;
    }
    
    .search-container button {
      transition: var(--transition);

      width: auto;
      border-radius: 0 var(--border-radius) var(--border-radius) 0;
      padding: 0 16px;
    }
    
    /* قسم طلب الشراء الجديد */
    .order-section {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
      background: #f9f9f9;
      border-radius: var(--border-radius);
      margin-top: 10px;
    }
    
    .order-section.expanded {
      max-height: 500px;
      padding: 12px;
      margin-top: 10px;
    }
    
    .order-section input {
      margin-bottom: 8px;
    }
    
    .order-buttons {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    
    .order-buttons button {
      transition: var(--transition);

      flex: 1;
      padding: 8px;
    }
    
    .order-buttons button.cancel {
      background: #6c757d;
    }
    
    /* تعديلات للهواتف الصغيرة */
    @media (max-width: 768px) {
      header {
        flex-direction: column;
        align-items: stretch;
      }
      
      .header-left, .header-right {
        flex-direction: column;
        gap: 8px;
      }
      
      .welcome {
        font-size: 1rem;
        margin: 5px 0;
      }
      
      h1 {
        font-size: 1.5rem;
      }
      
      #products, .admin-products {
        grid-template-columns: 1fr;
        padding: 10px;
      }
      
      .card {
      animation: fadeInUp 0.6s ease-in-out;

        width: 100%;
      }
      
      .admin-tab {
        padding: 8px 12px;
        font-size: 0.85rem;
      }
      
      .top-buttons {
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .top-buttons button {
      transition: var(--transition);

        width: auto;
        padding: 8px 12px;
      }
      
      .search-container {
        flex-direction: column;
      }
      
      .search-container input {
        border-radius: var(--border-radius);
        margin-bottom: 5px;
      }
      
      .search-container button {
      transition: var(--transition);

        border-radius: var(--border-radius);
        width: 100%;
      }
    }
    
    /* تعديلات للأجهزة اللوحية */
    @media (min-width: 481px) and (max-width: 768px) {
      #products, .admin-products {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  
@keyframes fadeInUp {
  0% {
    opacity: 0;
    transform: translateY(20px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

.search-container {
  display: flex;
  flex-direction: row-reverse;
  align-items: center;
  justify-content: space-between;
}
.search-icon-button {
  background: none;
  border: none;
  cursor: pointer;
  color: var(--primary-color);
  font-size: 1.2rem;
  padding: 0 12px;
}
.search-icon-button:hover {
  color: var(--secondary-color);
}
    </style>
</head>
<body>
<header>
<div class="header-left">
<div class="top-buttons">
<button onclick="showAboutSection()">من نحن</button>
<button onclick="showContactSection()">تواصل معنا</button>
</div>
<div class="welcome">( مرحباً بك في SFW! تسوّق بذكاء واكتشف كل جديد! )</div>
</div>
<div class="header-right">
<i class="fas fa-sign-in-alt login-icon" onclick="toggleLoginForm()"></i>
</div>
<div class="login-form" id="loginForm">
<h2>تسجيل دخول الأدمن</h2>
<input id="adminUser" placeholder="اسم المستخدم" type="text"/>
<input id="adminPass" placeholder="كلمة المرور" type="password"/>
<button onclick="loginAdmin()">دخول</button>
<button onclick="toggleLoginForm()" style="background: #6c757d;">إلغاء</button>
</div>
</header>
<div class="main-store">
<div class="about-section" id="aboutSection">
<h2>من نحن</h2>
<p>نحن شركة متخصصة في تقديم حلول رقمية متكاملة، تشمل تصميم وتطوير المتاجر الإلكترونية، وتطبيقات إدارة الأنشطة بمختلف أنواعها. كما نُبدع في تصميم الهويات البصرية وابتكار محتوى احترافي للسوشيال ميديا يعزز حضور علامتك التجارية ويُبرز تميزك في السوق.</p>
<button onclick="hideAboutSection()">العودة</button>
</div>
<div class="contact-section" id="contactSection">
<h2>تواصل معنا</h2>
<p>البريد الإلكتروني: dodsmart7@gmail.com</p>
<input id="contactName" placeholder="اسمك" type="text"/>
<input id="contactEmail" placeholder="بريدك الإلكتروني" type="email"/>
<textarea id="contactMessage" placeholder="رسالتك"></textarea>
<button onclick="sendContactMessage()">إرسال الرسالة</button>
<button onclick="hideContactSection()">إلغاء</button>
</div>
<h1>معروضات المتجر</h1>
<!-- شريط البحث -->
<div class="search-container" style="justify-content: flex-end;"><input id="searchInput" placeholder="ابحث عن منتج..." style="flex: 1; max-width: 100%;" type="text"/><button class="search-icon-button" onclick="searchProducts()"><i class="fas fa-search"></i></button></div>
<div id="products"></div>
</div>
<div class="admin-section">
<button onclick="logoutAdmin()">خروج الأدمن</button>
<div class="admin-tabs">
<div class="admin-tab active" onclick="switchAdminTab('products-tab')">معروضات المتجر</div>
<div class="admin-tab" onclick="switchAdminTab('add-tab')">إضافة منتج</div>
<div class="admin-tab" onclick="switchAdminTab('orders-tab')">طلبات الشراء</div>
<div class="admin-tab" onclick="switchAdminTab('messages-tab')">رسائل العملاء</div>
</div>
<div class="admin-tab-content active" id="products-tab">
<h2>إدارة معروضات المتجر</h2>
<div class="admin-products" id="adminProducts"></div>
</div>
<div class="admin-tab-content" id="add-tab">
<h2>إضافة منتج جديد</h2>
<div class="admin-panel">
<input id="productName" placeholder="اسم المنتج" type="text"/>
<input id="productPrice" placeholder="السعر" type="text"/>
<textarea id="productDetails" placeholder="التفاصيل"></textarea>
<input accept="image/*" id="productImageFile" type="file"/>
<button onclick="addProduct()">إضافة منتج</button>
</div>
</div>
<div class="admin-tab-content" id="orders-tab">
<h2>طلبات الشراء</h2>
<table id="ordersTable">
<tr><th>المنتج</th><th>الكمية</th><th>العميل</th><th>الهاتف</th><th>العنوان</th><th>إجراء</th></tr>
</table>
</div>
<div class="admin-tab-content" id="messages-tab">
<h2>رسائل العملاء</h2>
<table id="messagesTable">
<tr><th>الاسم</th><th>البريد الإلكتروني</th><th>الرسالة</th><th>التاريخ</th><th>إجراء</th></tr>
</table>
</div>
</div>
<script>
    const firebaseConfig = {
      apiKey: "AIzaSyC0BkNX-62lynXzcGxhLu3QiJLvU4vOQOM",
      authDomain: "sfw-online-store.firebaseapp.com",
      databaseURL: "https://sfw-online-store-default-rtdb.firebaseio.com",
      projectId: "sfw-online-store",
      storageBucket: "sfw-online-store.appspot.com",
      messagingSenderId: "98460253065",
      appId: "1:98460253065:web:2837e86960f8d799cbff58",
      measurementId: "G-TFRHLFMMJV"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // متغير لتخزين جميع المنتجات للبحث
    let allProducts = [];

    function renderProducts(products = null) {
      const productsToRender = products || allProducts;
      const container = document.getElementById('products');
      container.innerHTML = '';
      
      productsToRender.forEach(product => {
        const card = document.createElement('div');
        card.className = 'card';
        
        let showMoreBtn = '';
        if (product.details.length > 150) {
          showMoreBtn = '<div class="show-more" onclick="toggleDetails(this)">المزيد ▼</div>';
        }
        
        card.innerHTML = `
          <img src="${product.image}" alt="صورة المنتج">
          <h3>${product.name}</h3>
          <div class="product-details">${product.details}</div>
          ${showMoreBtn}
          <p><strong>${product.price} جنيه</strong></p>
          <button onclick="toggleOrderSection('${product.id}')">طلب شراء</button>
          <div class="order-section" id="order-section-${product.id}">
            <input type="number" min="1" value="1" placeholder="الكمية" id="qty-${product.id}">
            <input type="text" placeholder="اسمك" id="name-${product.id}">
            <input type="tel" placeholder="رقم الهاتف" id="phone-${product.id}">
            <input type="text" placeholder="العنوان" id="address-${product.id}">
            <div class="order-buttons">
              <button onclick="submitOrder('${product.id}')">حفظ الطلب</button>
              <button class="cancel" onclick="toggleOrderSection('${product.id}')">إلغاء</button>
            </div>
          </div>
        `;
        container.appendChild(card);
      });
    }

    function renderAdminProducts() {
      db.ref('products').on('value', snapshot => {
        const container = document.getElementById('adminProducts');
        container.innerHTML = '';
        snapshot.forEach(child => {
          const data = child.val();
          const key = child.key;
          const card = document.createElement('div');
          card.className = 'card';
          
          let showMoreBtn = '';
          if (data.details.length > 100) {
            showMoreBtn = '<div class="show-more" onclick="toggleDetails(this)">المزيد ▼</div>';
          }
          
          card.innerHTML = `
            <img src="${data.image}" alt="صورة المنتج">
            <h3>${data.name}</h3>
            <div class="product-details">${data.details}</div>
            ${showMoreBtn}
            <p><strong>${data.price} جنيه</strong></p>
            <button onclick="showEditForm('${key}')">تعديل</button>
            <button onclick="deleteProduct('${key}')">حذف</button>
            <div class="edit-form" id="edit-form-${key}">
              <input type="text" id="edit-name-${key}" value="${data.name}" placeholder="اسم المنتج">
              <input type="text" id="edit-price-${key}" value="${data.price}" placeholder="السعر">
              <textarea id="edit-details-${key}" placeholder="التفاصيل">${data.details}</textarea>
              <button onclick="updateProduct('${key}')">حفظ التعديلات</button>
              <button onclick="hideEditForm('${key}')">إلغاء</button>
            </div>
          `;
          container.appendChild(card);
        });
      });
    }

    function toggleDetails(element) {
      const detailsDiv = element.previousElementSibling;
      detailsDiv.classList.toggle('expanded');
      element.textContent = detailsDiv.classList.contains('expanded') ? 'إخفاء ▲' : 'المزيد ▼';
    }

    function toggleOrderSection(productId) {
      const orderSection = document.getElementById(`order-section-${productId}`);
      orderSection.classList.toggle('expanded');
    }

    function submitOrder(productId) {
      const qty = document.getElementById(`qty-${productId}`).value;
      const name = document.getElementById(`name-${productId}`).value;
      const phone = document.getElementById(`phone-${productId}`).value;
      const address = document.getElementById(`address-${productId}`).value;
      
      if (!qty || parseInt(qty) < 1) return alert('الكمية يجب أن تكون رقم موجب');
      if (!name) return alert('يرجى إدخال اسمك');
      if (!phone) return alert('يرجى إدخال رقم الهاتف');
      if (!address) return alert('يرجى إدخال العنوان');
      
      // الحصول على اسم المنتج من البيانات المحلية
      const product = allProducts.find(p => p.id === productId);
      if (!product) return alert('المنتج غير موجود');
      
      db.ref('orders').push({ 
        productName: product.name, 
        qty, 
        name, 
        phone, 
        address,
        timestamp: firebase.database.ServerValue.TIMESTAMP
      })
      .then(() => {
        alert('تم إرسال الطلب بنجاح');
        toggleOrderSection(productId);
        // مسح حقول النموذج
        document.getElementById(`qty-${productId}`).value = '1';
        document.getElementById(`name-${productId}`).value = '';
        document.getElementById(`phone-${productId}`).value = '';
        document.getElementById(`address-${productId}`).value = '';
      })
      .catch(error => {
        console.error('Error saving order:', error);
        alert('حدث خطأ أثناء حفظ الطلب، يرجى المحاولة مرة أخرى');
      });
    }

    function toggleLoginForm() {
      document.getElementById('loginForm').classList.toggle('active');
    }

    function loginAdmin() {
      const user = document.getElementById('adminUser').value;
      const pass = document.getElementById('adminPass').value;
      if (user === 'admin' && pass === '1234') {
        document.querySelector('.admin-section').style.display = 'block';
        document.body.classList.add('admin-logged-in');
        toggleLoginForm();
        loadOrders();
        loadMessages();
        renderAdminProducts();
      } else {
        alert('بيانات الدخول غير صحيحة');
      }
    }

    function logoutAdmin() {
      document.querySelector('.admin-section').style.display = 'none';
      document.body.classList.remove('admin-logged-in');
    }

    function switchAdminTab(tabId) {
      document.querySelectorAll('.admin-tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      document.querySelectorAll('.admin-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      document.getElementById(tabId).classList.add('active');
      document.querySelector(`.admin-tab[onclick="switchAdminTab('${tabId}')"]`).classList.add('active');
      
      if (tabId === 'orders-tab') {
        loadOrders();
      } else if (tabId === 'products-tab') {
        renderAdminProducts();
      } else if (tabId === 'messages-tab') {
        loadMessages();
      }
    }

    function addProduct() {
      const name = document.getElementById('productName').value;
      const price = document.getElementById('productPrice').value;
      const details = document.getElementById('productDetails').value;
      const fileInput = document.getElementById('productImageFile');
      
      if (!name || !price || !details) {
        return alert('يرجى ملء جميع الحقول');
      }
      
      if (!fileInput.files[0]) {
        return alert('يرجى اختيار صورة للمنتج');
      }
      
      const reader = new FileReader();
      reader.onload = function(event) {
        const imageData = event.target.result;
        db.ref('products').push({ 
          name, 
          price, 
          details, 
          image: imageData,
          createdAt: firebase.database.ServerValue.TIMESTAMP
        });
        
        alert('تمت إضافة المنتج بنجاح');
        document.getElementById('productName').value = '';
        document.getElementById('productPrice').value = '';
        document.getElementById('productDetails').value = '';
        fileInput.value = '';
        
        switchAdminTab('products-tab');
      };
      reader.readAsDataURL(fileInput.files[0]);
    }

    function showEditForm(productId) {
      document.getElementById(`edit-form-${productId}`).style.display = 'block';
    }

    function hideEditForm(productId) {
      document.getElementById(`edit-form-${productId}`).style.display = 'none';
    }

    function updateProduct(productId) {
      const name = document.getElementById(`edit-name-${productId}`).value;
      const price = document.getElementById(`edit-price-${productId}`).value;
      const details = document.getElementById(`edit-details-${productId}`).value;
      
      if (!name || !price || !details) {
        return alert('يرجى ملء جميع الحقول');
      }
      
      db.ref('products/' + productId).update({
        name: name,
        price: price,
        details: details,
        updatedAt: firebase.database.ServerValue.TIMESTAMP
      });
      
      alert('تم تحديث المنتج بنجاح');
      hideEditForm(productId);
    }

    function deleteProduct(productId) {
      if (confirm('هل أنت متأكد من حذف هذا المنتج؟')) {
        db.ref('products/' + productId).remove();
        alert('تم حذف المنتج بنجاح');
      }
    }

    function loadOrders() {
      db.ref('orders').orderByChild('timestamp').on('value', snapshot => {
        const table = document.getElementById('ordersTable');
        table.innerHTML = '<tr><th>المنتج</th><th>الكمية</th><th>العميل</th><th>الهاتف</th><th>العنوان</th><th>إجراء</th></tr>';
        
        const orders = [];
        snapshot.forEach(child => {
          orders.push({
            key: child.key,
            ...child.val()
          });
        });
        
        // عرض الطلبات من الأحدث إلى الأقدم
        orders.reverse().forEach(order => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${order.productName}</td>
            <td>${order.qty}</td>
            <td>${order.name}</td>
            <td>${order.phone}</td>
            <td>${order.address}</td>
            <td><button onclick="deleteOrder('${order.key}')">تم التنفيذ</button></td>
          `;
          table.appendChild(row);
        });
      });
    }

    function deleteOrder(orderId) {
      if (confirm('هل تم تنفيذ هذا الطلب؟')) {
        db.ref('orders/' + orderId).remove();
      }
    }
    
    function showAboutSection() {
      document.getElementById('aboutSection').style.display = 'block';
      document.getElementById('products').style.display = 'none';
      document.querySelector('.main-store h1').style.display = 'none';
      document.querySelector('.search-container').style.display = 'none';
    }
    
    function hideAboutSection() {
      document.getElementById('aboutSection').style.display = 'none';
      document.getElementById('products').style.display = 'grid';
      document.querySelector('.main-store h1').style.display = 'block';
      document.querySelector('.search-container').style.display = 'flex';
    }
    
    function showContactSection() {
      document.getElementById('contactSection').style.display = 'block';
      document.getElementById('products').style.display = 'none';
      document.querySelector('.main-store h1').style.display = 'none';
      document.querySelector('.search-container').style.display = 'none';
    }
    
    function hideContactSection() {
      document.getElementById('contactSection').style.display = 'none';
      document.getElementById('products').style.display = 'grid';
      document.querySelector('.main-store h1').style.display = 'block';
      document.querySelector('.search-container').style.display = 'flex';
    }
    
    function sendContactMessage() {
      const name = document.getElementById('contactName').value;
      const email = document.getElementById('contactEmail').value;
      const message = document.getElementById('contactMessage').value;
      
      if (!name || !email || !message) {
        return alert('يرجى ملء جميع الحقول');
      }
      
      db.ref('messages').push({
        name: name,
        email: email,
        message: message,
        timestamp: firebase.database.ServerValue.TIMESTAMP
      });
      
      alert('تم إرسال رسالتك بنجاح، شكراً لتواصلك معنا!');
      document.getElementById('contactName').value = '';
      document.getElementById('contactEmail').value = '';
      document.getElementById('contactMessage').value = '';
      hideContactSection();
    }
    
    function loadMessages() {
      db.ref('messages').orderByChild('timestamp').on('value', snapshot => {
        const table = document.getElementById('messagesTable');
        table.innerHTML = '<tr><th>الاسم</th><th>البريد الإلكتروني</th><th>الرسالة</th><th>التاريخ</th><th>إجراء</th></tr>';
        
        const messages = [];
        snapshot.forEach(child => {
          messages.push({
            key: child.key,
            ...child.val()
          });
        });
        
        // عرض الرسائل من الأحدث إلى الأقدم
        messages.reverse().forEach(msg => {
          const date = new Date(msg.timestamp);
          const dateStr = date.toLocaleDateString('ar-EG') + ' ' + date.toLocaleTimeString('ar-EG');
          
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${msg.name}</td>
            <td>${msg.email}</td>
            <td>${msg.message}</td>
            <td>${dateStr}</td>
            <td><button onclick="deleteMessage('${msg.key}')">حذف</button></td>
          `;
          table.appendChild(row);
        });
      });
    }
    
    function deleteMessage(messageId) {
      if (confirm('هل تريد حذف هذه الرسالة؟')) {
        db.ref('messages/' + messageId).remove();
      }
    }
    
    // وظيفة البحث عن المنتجات
    function searchProducts() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      if (!searchTerm) {
        renderProducts(allProducts);
        return;
      }
      
      const filteredProducts = allProducts.filter(product => 
        product.name.toLowerCase().includes(searchTerm) || 
        product.details.toLowerCase().includes(searchTerm) ||
        product.price.toLowerCase().includes(searchTerm)
      );
      
      renderProducts(filteredProducts);
    }
    
    // تحميل المنتجات عند بدء التشغيل
    document.addEventListener('DOMContentLoaded', () => {
      db.ref('products').on('value', snapshot => {
        allProducts = [];
        snapshot.forEach(child => {
          allProducts.push({
            id: child.key,
            ...child.val()
          });
        });
        renderProducts();
      });
      
      // تفعيل البحث عند الضغط على زر Enter
      document.getElementById('searchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          searchProducts();
        }
      });
    });
  </script>
</body>
</html>
